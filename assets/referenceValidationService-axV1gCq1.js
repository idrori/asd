import{R as d,g as V}from"./index-BkoPM6Yr.js";function P(a){return a?a.split(/\s+and\s+/i).map(e=>e.trim()).filter(e=>e.length>0):[]}function v(a,t){const e=[new RegExp(`${t}\\s*=\\s*\\{([^}]*)\\}`,"i"),new RegExp(`${t}\\s*=\\s*"([^"]*)"`,"i"),new RegExp(`${t}\\s*=\\s*(\\d+)`,"i")];for(const n of e){const r=a.match(n);if(r)return r[1].trim()}}function N(a){const t=a.match(/%\s*Relevance:\s*(.+?)(?:\n|$)/i);return t?t[1].trim():void 0}function F(a,t=""){const e=a.match(/@(\w+)\s*\{\s*([^,\s]+)\s*,/i);if(!e)return null;const n=e[1].toLowerCase(),r=e[2],o=v(a,"title")||"",i=v(a,"author")||"",c=v(a,"year"),s=v(a,"journal"),f=v(a,"booktitle"),l=v(a,"publisher"),p=v(a,"volume"),y=v(a,"number"),u=v(a,"pages"),h=v(a,"doi"),m=v(a,"url"),g=c?parseInt(c,10):void 0,j=P(i),T=N(t),D=o.replace(/\{([^}]*)\}/g,"$1").replace(/\\&/g,"&").replace(/\\/g,"").trim();return{type:n,key:r,title:D,authors:j,year:isNaN(g)?void 0:g,journal:s,booktitle:f,publisher:l,volume:p,number:y,pages:u,doi:h,url:m,relevanceComment:T,rawEntry:a.trim()}}function x(a){const t=[],e=[],n=/@(\w+)\s*\{/gi;let r;const o=[];for(;(r=n.exec(a))!==null;)o.push(r.index);for(let i=0;i<o.length;i++){const c=o[i];i<o.length-1?o[i+1]:a.length;let s=0,f=c,l=!1;for(let u=c;u<a.length;u++){const h=a[u];if(h==="{")s++,l=!0;else if(h==="}"&&(s--,l&&s===0)){f=u+1;break}}const p=a.substring(c,f),y=a.substring(Math.max(0,c-200),c);try{const u=F(p,y);u&&(u.title?t.push(u):e.push(`Entry "${u.key}" has no title`))}catch(u){e.push(`Failed to parse entry at position ${c}: ${u}`)}}return{entries:t,errors:e,rawContent:a}}function R(a,t){const e={...a,...t},n=[];n.push(`@${e.type}{${e.key},`),e.authors&&e.authors.length>0&&n.push(`  author = {${e.authors.join(" and ")}},`),n.push(`  title = {${e.title}},`),e.journal&&n.push(`  journal = {${e.journal}},`),e.booktitle&&n.push(`  booktitle = {${e.booktitle}},`),e.publisher&&n.push(`  publisher = {${e.publisher}},`),e.year&&n.push(`  year = {${e.year}},`),e.volume&&n.push(`  volume = {${e.volume}},`),e.number&&n.push(`  number = {${e.number}},`),e.pages&&n.push(`  pages = {${e.pages}},`),e.doi&&n.push(`  doi = {${e.doi}},`),e.url&&n.push(`  url = {${e.url}},`);const r=n[n.length-1];return n[n.length-1]=r.replace(/,$/,""),n.push("}"),n.join(`
`)}function $(a,t,e){const n=a.split(/[,\s]+/)[0].toLowerCase().replace(/[^a-z]/g,""),r=t?t.toString():"nd",o=e.toLowerCase().replace(/^(the|a|an)\s+/i,"").split(/\s+/)[0].replace(/[^a-z]/g,"");return`${n}${r}${o}`}function O(a,t){const e=a.length,n=t.length,r=Array(e+1).fill(null).map(()=>Array(n+1).fill(0));for(let o=0;o<=e;o++)r[o][0]=o;for(let o=0;o<=n;o++)r[0][o]=o;for(let o=1;o<=e;o++)for(let i=1;i<=n;i++)a[o-1]===t[i-1]?r[o][i]=r[o-1][i-1]:r[o][i]=1+Math.min(r[o-1][i],r[o][i-1],r[o-1][i-1]);return r[e][n]}function S(a){return a.toLowerCase().replace(/[^\w\s-]/g," ").replace(/\s+/g," ").replace(/\b(the|a|an|of|and|in|on|for|to|with)\b/g,"").replace(/\s+/g," ").trim()}function B(a,t){const e=S(a),n=S(t);if(e===n)return 1;if(e.length===0||n.length===0)return 0;const r=O(e,n),o=Math.max(e.length,n.length);return 1-r/o}function U(a,t){const e=S(a),n=S(t);if(e===n)return 1;const r=e.split(/[:\-–—]/)[0].trim(),o=n.split(/[:\-–—]/)[0].trim();if(r===o&&r.length>10)return .95;const i=B(a,t);return e.includes(n)||n.includes(e)?Math.max(i,.85):i}function M(a){const t=a.trim();if(t.includes(","))return t.split(",")[0].trim().toLowerCase();const e=t.split(/\s+/);return e.length>=2?e[e.length-1].toLowerCase():t.toLowerCase()}function _(a,t){if(a.length===0||t.length===0)return 0;const e=a.map(M),n=t.map(M),r=e[0]===n[0],o=e.filter(s=>n.includes(s)).length,i=Math.max(e.length,n.length),c=o/i;return r?.5+.5*c:c*.8}function J(a,t){if(a.doi&&t.doi){const n=a.doi.toLowerCase().replace(/^https?:\/\/doi\.org\//i,""),r=t.doi.toLowerCase().replace(/^https?:\/\/doi\.org\//i,"");if(n===r)return!0}const e=U(a.title,t.title);return!!(e>.95||e>.85&&a.year&&t.year&&a.year===t.year||e>.75&&a.authors&&t.authors&&a.year&&t.year&&_(a.authors,t.authors)>.5&&Math.abs(a.year-t.year)<=1)}var L={};const z=typeof window<"u"?"":L.VERCEL_URL?`https://${L.VERCEL_URL}`:"http://localhost:3000",I=`${z}/api/semantic-scholar`,W=.85,Y=.65,b=2020,E=2025,X=5,C=10,G=5,w={davis1989perceived:{author:"Davis, Fred D.",title:"Perceived usefulness, perceived ease of use, and user acceptance of information technology",journal:"MIS Quarterly",year:1989,volume:"13",number:"3",pages:"319--340",doi:"10.2307/249008"},davis1989user:{author:"Davis, Fred D. and Bagozzi, Richard P. and Warshaw, Paul R.",title:"User acceptance of computer technology: A comparison of two theoretical models",journal:"Management Science",year:1989,volume:"35",number:"8",pages:"982--1003"},venkatesh2003user:{author:"Venkatesh, Viswanath and Morris, Michael G. and Davis, Gordon B. and Davis, Fred D.",title:"User acceptance of information technology: Toward a unified view",journal:"MIS Quarterly",year:2003,volume:"27",number:"3",pages:"425--478",doi:"10.2307/30036540"},venkatesh2012consumer:{author:"Venkatesh, Viswanath and Thong, James Y. L. and Xu, Xin",title:"Consumer acceptance and use of information technology: Extending the unified theory of acceptance and use of technology",journal:"MIS Quarterly",year:2012,volume:"36",number:"1",pages:"157--178"},delone1992information:{author:"DeLone, William H. and McLean, Ephraim R.",title:"Information systems success: The quest for the dependent variable",journal:"Information Systems Research",year:1992,volume:"3",number:"1",pages:"60--95",doi:"10.1287/isre.3.1.60"},delone2003delone:{author:"DeLone, William H. and McLean, Ephraim R.",title:"The DeLone and McLean model of information systems success: A ten-year update",journal:"Journal of Management Information Systems",year:2003,volume:"19",number:"4",pages:"9--30"},hevner2004design:{author:"Hevner, Alan R. and March, Salvatore T. and Park, Jinsoo and Ram, Sudha",title:"Design science in information systems research",journal:"MIS Quarterly",year:2004,volume:"28",number:"1",pages:"75--105",doi:"10.2307/25148625"},gregor2013positioning:{author:"Gregor, Shirley and Hevner, Alan R.",title:"Positioning and presenting design science research for maximum impact",journal:"MIS Quarterly",year:2013,volume:"37",number:"2",pages:"337--355"},peffers2007design:{author:"Peffers, Ken and Tuunanen, Tuure and Rothenberger, Marcus A. and Chatterjee, Samir",title:"A design science research methodology for information systems research",journal:"Journal of Management Information Systems",year:2007,volume:"24",number:"3",pages:"45--77"},orlikowski1992duality:{author:"Orlikowski, Wanda J.",title:"The duality of technology: Rethinking the concept of technology in organizations",journal:"Organization Science",year:1992,volume:"3",number:"3",pages:"398--427",doi:"10.1287/orsc.3.3.398"},orlikowski2000using:{author:"Orlikowski, Wanda J.",title:"Using technology and constituting structures: A practice lens for studying technology in organizations",journal:"Organization Science",year:2e3,volume:"11",number:"4",pages:"404--428"},dimaggio1983iron:{author:"DiMaggio, Paul J. and Powell, Walter W.",title:"The iron cage revisited: Institutional isomorphism and collective rationality in organizational fields",journal:"American Sociological Review",year:1983,volume:"48",number:"2",pages:"147--160"},barabasi1999emergence:{author:"Barabasi, Albert-Laszlo and Albert, Reka",title:"Emergence of scaling in random networks",journal:"Science",year:1999,volume:"286",number:"5439",pages:"509--512"},barabasi2016network:{author:"Barabasi, Albert-Laszlo",title:"Network science",journal:"Cambridge University Press",year:2016},newman2001structure:{author:"Newman, Mark E. J.",title:"The structure of scientific collaboration networks",journal:"Proceedings of the National Academy of Sciences",year:2001,volume:"98",number:"2",pages:"404--409"},newman2003mixing:{author:"Newman, Mark E. J.",title:"Mixing patterns in networks",journal:"Physical Review E",year:2003,volume:"67",number:"2",pages:"026126"},merton1968matthew:{author:"Merton, Robert K.",title:"The Matthew effect in science",journal:"Science",year:1968,volume:"159",number:"3810",pages:"56--63"},merton1973sociology:{author:"Merton, Robert K.",title:"The sociology of science: Theoretical and empirical investigations",journal:"University of Chicago Press",year:1973},crane1972invisible:{author:"Crane, Diana",title:"Invisible colleges: Diffusion of knowledge in scientific communities",journal:"University of Chicago Press",year:1972},bandura1977social:{author:"Bandura, Albert",title:"Social learning theory",journal:"Prentice Hall",year:1977},bourdieu1986forms:{author:"Bourdieu, Pierre",title:"The forms of capital",journal:"Handbook of Theory and Research for the Sociology of Education",year:1986,pages:"241--258"},burt2004structural:{author:"Burt, Ronald S.",title:"Structural holes and good ideas",journal:"American Journal of Sociology",year:2004,volume:"110",number:"2",pages:"349--399"},wasserman1994social:{author:"Wasserman, Stanley and Faust, Katherine",title:"Social network analysis: Methods and applications",journal:"Cambridge University Press",year:1994},freeman1977set:{author:"Freeman, Linton C.",title:"A set of measures of centrality based on betweenness",journal:"Sociometry",year:1977,volume:"40",number:"1",pages:"35--41"},blondel2008fast:{author:"Blondel, Vincent D. and Guillaume, Jean-Loup and Lambiotte, Renaud and Lefebvre, Etienne",title:"Fast unfolding of communities in large networks",journal:"Journal of Statistical Mechanics: Theory and Experiment",year:2008,volume:"2008",number:"10",pages:"P10008"},malmgren2010role:{author:"Malmgren, R. Dean and Ottino, Julio M. and Amaral, Luis A. Nunes",title:"The role of mentorship in protege performance",journal:"Nature",year:2010,volume:"465",number:"7298",pages:"622--626"},clauset2015systematic:{author:"Clauset, Aaron and Arbesman, Samuel and Larremore, Daniel B.",title:"Systematic inequality and hierarchy in faculty hiring networks",journal:"Science Advances",year:2015,volume:"1",number:"1",pages:"e1400005"},stinchcombe1965social:{author:"Stinchcombe, Arthur L.",title:"Social structure and organizations",journal:"Handbook of Organizations",year:1965,pages:"142--193"},marquis2013imprinting:{author:"Marquis, Christopher and Tilcsik, Andras",title:"Imprinting: Toward a multilevel theory",journal:"Academy of Management Annals",year:2013,volume:"7",number:"1",pages:"195--245"},benbasat2003identity:{author:"Benbasat, Izak and Zmud, Robert W.",title:"The identity crisis within the IS discipline: Defining and communicating the discipline's core properties",journal:"MIS Quarterly",year:2003,volume:"27",number:"2",pages:"183--194"},sidorova2008uncovering:{author:"Sidorova, Anna and Evangelopoulos, Nicholas and Valacich, Joseph S. and Ramakrishnan, Thiagarajan",title:"Uncovering the intellectual core of the information systems discipline",journal:"MIS Quarterly",year:2008,volume:"32",number:"3",pages:"467--482"},grover2012state:{author:"Grover, Varun and Lyytinen, Kalle and Srinivasan, Ananth and Tan, Bernard C. Y.",title:"Contributing to rigorous and forward thinking explanatory theory",journal:"Journal of the Association for Information Systems",year:2012,volume:"13",number:"6",pages:"393--422"},lowry2013state:{author:"Lowry, Paul Benjamin and Moody, Gregory D. and Gaskin, James and Galletta, Dennis F. and Humpherys, Sean L. and Barlow, Jordan B. and Wilson, David W.",title:"Evaluating journal quality and the Association for Information Systems Senior Scholars' journal basket via bibliometric measures",journal:"MIS Quarterly",year:2013,volume:"37",number:"4",pages:"993--1012"},hirschheim2012information:{author:"Hirschheim, Rudy and Klein, Heinz K.",title:"A glorious and not-so-short history of the information systems field",journal:"Journal of the Association for Information Systems",year:2012,volume:"13",number:"4",pages:"188--235"}};function H(a){if(w[a])return w[a];const t=a.match(/^([a-z]+)(\d{4})/i);if(t){const[,e,n]=t,r=parseInt(n,10);for(const[o,i]of Object.entries(w))if(o.toLowerCase().startsWith(e.toLowerCase())&&i.year===r)return i}}function Q(a,t){const e=[];return e.push("% Status: VERIFIED | Source: KNOWN_DB | Confidence: 95%"),e.push(`@article{${a},`),e.push(`  author = {${t.author}},`),e.push(`  title = {${t.title}},`),e.push(`  journal = {${t.journal}},`),e.push(`  year = {${t.year}}`),t.volume&&e.push(`, volume = {${t.volume}}`),t.number&&e.push(`, number = {${t.number}}`),t.pages&&e.push(`, pages = {${t.pages}}`),t.doi&&e.push(`, doi = {${t.doi}}`),e.push("}"),e.join(`
`)}async function q(a){try{const t=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"validate",references:a})});return t.ok?await t.json():(console.error(`[RefValidation] SS validate failed: ${t.status}`),{success:!1,results:[]})}catch(t){return console.error("[RefValidation] SS validate error:",t),{success:!1,results:[]}}}async function k(a,t){try{const e=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"search",keywords:a,fieldsOfStudy:["Computer Science"],yearMin:(t==null?void 0:t.yearMin)||b,yearMax:(t==null?void 0:t.yearMax)||E,limit:(t==null?void 0:t.limit)||C})});return e.ok?await e.json():(console.error(`[RefValidation] SS search failed: ${e.status}`),{success:!1,papers:[]})}catch(e){return console.error("[RefValidation] SS search error:",e),{success:!1,papers:[]}}}async function Z(a,t){try{const e=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"citations",paperId:a,type:t,limit:G})});return e.ok?await e.json():{success:!1,papers:[]}}catch(e){return console.error("[RefValidation] SS citations error:",e),{success:!1,papers:[]}}}async function K(a){console.log(`[RefValidation] Phase 2: Validating ${a.length} LLM references`);const t=a.map(n=>({bibKey:n.key,title:n.title,authors:n.authors,year:n.year})),e=await q(t);return e.success?e.results.map(n=>{const r=a.find(o=>o.key===n.bibKey);return{bibKey:n.bibKey,originalTitle:n.originalTitle,originalAuthors:r==null?void 0:r.authors,originalYear:r==null?void 0:r.year,status:n.status==="VERIFIED"?d.VERIFIED:n.status==="PARTIAL"?d.PARTIAL:d.UNVERIFIED,confidence:n.confidence,ssMatch:n.paper,discrepancies:n.discrepancies,source:"LLM"}}):a.map(n=>({bibKey:n.key,originalTitle:n.title,originalAuthors:n.authors,originalYear:n.year,status:d.UNVERIFIED,confidence:0,source:"LLM"}))}function ee(a){const t=a.toLowerCase(),e=["information systems","digital transformation","artificial intelligence","machine learning","technology adoption","user acceptance","blockchain","social media","cybersecurity","data analytics","cloud computing","e-commerce","digital platform","IT governance","knowledge management","business intelligence","enterprise systems","human-computer interaction","technology acceptance model","TAM","UTAUT","IS success","digital innovation","IT investment","software development","agile","devops","healthcare IT","fintech","smart city","IoT","internet of things"],n=[];for(const o of e)t.includes(o.toLowerCase())&&n.push(o);const r=t.split(/\s+/).filter(o=>o.length>4);return[...new Set(r)],n.slice(0,X)}async function te(a,t){var i,c,s,f,l,p,y;console.log("[RefValidation] Phase 3: Discovering additional papers");const e=[],n=new Set(t.map(u=>u.originalTitle.toLowerCase())),r=ee(a);if(r.length>0){console.log(`[RefValidation] Searching with keywords: ${r.join(", ")}`);const u=await k(r,{yearMin:b,yearMax:E,limit:C});if(u.success)for(const h of u.papers)n.has(h.title.toLowerCase())||(h.citationCount||0)<5||(e.push({bibKey:$(((c=(i=h.authors)==null?void 0:i[0])==null?void 0:c.name)||"unknown",h.year,h.title),originalTitle:h.title,originalAuthors:(s=h.authors)==null?void 0:s.map(m=>m.name),originalYear:h.year,status:d.DISCOVERED,confidence:1,ssMatch:h,source:"SS_SEARCH"}),n.add(h.title.toLowerCase()))}const o=t.filter(u=>{var h;return u.status===d.VERIFIED&&((h=u.ssMatch)==null?void 0:h.paperId)});if(o.length>0)for(const u of o.slice(0,3)){if(!((f=u.ssMatch)!=null&&f.paperId))continue;const h=await Z(u.ssMatch.paperId,"citations");if(h.success)for(const m of h.papers)n.has(m.title.toLowerCase())||(m.citationCount||0)<10||!m.year||m.year<b||(e.push({bibKey:$(((p=(l=m.authors)==null?void 0:l[0])==null?void 0:p.name)||"unknown",m.year,m.title),originalTitle:m.title,originalAuthors:(y=m.authors)==null?void 0:y.map(g=>g.name),originalYear:m.year,status:d.DISCOVERED,confidence:1,ssMatch:m,source:"SS_CITATION_GRAPH"}),n.add(m.title.toLowerCase()))}return console.log(`[RefValidation] Discovered ${e.length} additional papers`),e}function ne(a,t,e){console.log("[RefValidation] Phase 4: Merging and deduplicating");const r=[...a].sort((i,c)=>{const s={[d.VERIFIED]:0,[d.PARTIAL]:1,[d.UNVERIFIED]:2,[d.REJECTED]:3,[d.DISCOVERED]:4};return s[i.status]-s[c.status]}).filter(i=>i.status!==d.REJECTED),o=new Set(r.map(i=>i.originalTitle.toLowerCase()));for(const i of t){if(r.length>=e.max)break;r.some(s=>J({title:s.originalTitle,authors:s.originalAuthors,year:s.originalYear},{title:i.originalTitle,authors:i.originalAuthors,year:i.originalYear}))||(r.push(i),o.add(i.originalTitle.toLowerCase()))}return console.log(`[RefValidation] Merged: ${r.length} references (${a.length} LLM + ${r.length-a.filter(i=>i.status!==d.REJECTED).length} discovered)`),r}function ae(a,t,e){var i,c,s,f;console.log("[RefValidation] Phase 5: Generating final BibTeX");const n=[];n.push("% === REFERENCE VALIDATION REPORT ==="),n.push(`% Timestamp: ${e.timestamp}`),n.push(`% Total references: ${e.totalReferences}`),n.push(`% Verified: ${e.verified} (${(e.verified/e.totalReferences*100).toFixed(0)}%)`),n.push(`% Partial: ${e.partial} (${(e.partial/e.totalReferences*100).toFixed(0)}%)`),n.push(`% Unverified: ${e.unverified} (${(e.unverified/e.totalReferences*100).toFixed(0)}%)`),n.push(`% Discovered: ${e.discovered} (${(e.discovered/e.totalReferences*100).toFixed(0)}%)`),n.push(`% Recency (${b}-${E}): ${(e.recencyScore*100).toFixed(0)}%`),n.push(`% Verification rate: ${(e.verificationRate*100).toFixed(0)}%`),n.push("% ====================================="),n.push("");const o=!a.some(l=>l.status===d.VERIFIED||l.status===d.PARTIAL||l.status===d.DISCOVERED);o&&(n.push("% WARNING: No verified references found. Including unverified entries as fallback."),n.push("% These references should be manually verified before submission."),n.push(""));for(const l of a){if(l.status===d.UNVERIFIED&&!o)continue;n.push(`% Status: ${l.status} | Source: ${l.source}${l.confidence<1?` | Confidence: ${(l.confidence*100).toFixed(0)}%`:""}`),l.discrepancies&&l.discrepancies.length>0&&n.push(`% Discrepancies: ${l.discrepancies.join("; ")}`);const p=t.find(y=>y.key===l.bibKey);if(p&&(l.status===d.VERIFIED||l.status===d.PARTIAL)){const y={};l.ssMatch&&(l.ssMatch.doi&&(y.doi=l.ssMatch.doi),l.ssMatch.url&&(y.url=l.ssMatch.url)),n.push(R(p,y))}else if(l.ssMatch){const y={type:(i=l.ssMatch.venue)!=null&&i.includes("Conference")||(c=l.ssMatch.venue)!=null&&c.includes("Proceedings")?"inproceedings":"article",key:l.bibKey,title:l.ssMatch.title,authors:((s=l.ssMatch.authors)==null?void 0:s.map(u=>u.name))||[],year:l.ssMatch.year,journal:(f=l.ssMatch.journal)==null?void 0:f.name,booktitle:l.ssMatch.venue,doi:l.ssMatch.doi,url:l.ssMatch.url,rawEntry:""};n.push(R(y))}else p&&n.push(R(p));n.push("")}return n.join(`
`)}async function ue(a,t,e){e!=null&&e.targetMin;const n=(e==null?void 0:e.targetMax)||35;console.log("[RefValidation] Starting reference validation pipeline");const r=x(a);if(r.errors.length>0&&console.warn("[RefValidation] BibTeX parse errors:",r.errors),r.entries.length===0)return console.error("[RefValidation] No valid BibTeX entries found"),{bibtex:a,report:{timestamp:new Date().toISOString(),totalReferences:0,verified:0,partial:0,unverified:0,rejected:0,discovered:0,recencyScore:0,verificationRate:0,hallucinationRate:0,validatedReferences:[],discoveredReferences:[],errors:["No valid BibTeX entries found"]}};console.log(`[RefValidation] Parsed ${r.entries.length} BibTeX entries`);const o=await K(r.entries);let i=[];e!=null&&e.skipDiscovery||(i=await te(t,o));const c=ne(o,i,{max:n}),s=c.filter(g=>g.status===d.VERIFIED).length,f=c.filter(g=>g.status===d.PARTIAL).length,l=c.filter(g=>g.status===d.UNVERIFIED).length,p=o.filter(g=>g.status===d.REJECTED).length,y=c.filter(g=>g.status===d.DISCOVERED).length,u=c.filter(g=>g.originalYear&&g.originalYear>=b&&g.originalYear<=E).length,h={timestamp:new Date().toISOString(),totalReferences:c.length,verified:s,partial:f,unverified:l,rejected:p,discovered:y,recencyScore:c.length>0?u/c.length:0,verificationRate:c.length>0?(s+f)/c.length:0,hallucinationRate:o.length>0?p/o.length:0,validatedReferences:o,discoveredReferences:i,errors:r.errors},m=ae(c,r.entries,h);return console.log(`[RefValidation] Complete: ${c.length} refs, ${(h.verificationRate*100).toFixed(0)}% verified, ${(h.recencyScore*100).toFixed(0)}% recent`),{bibtex:m,report:h}}function re(a){const t=a.match(/^([a-z]+)(\d{4})(.*)$/i);if(t)return{author:t[1],year:parseInt(t[2],10),keyword:t[3]||""};const e=a.match(/(\d{4})/),n=e?parseInt(e[1],10):null;return{author:a.replace(/\d+/g,"").replace(/[^a-zA-Z]/g,""),year:n,keyword:""}}function oe(a){const t=[];if(a.author&&t.push(a.author),a.keyword){const e=a.keyword.replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase();t.push(e)}return t.join(" ")}async function ie(a,t){if(t.has(a))return{citationKey:a,status:"ALREADY_EXISTS",confidence:1,bibtexEntry:""};console.log(`[IncrementalValidation] Validating citation: ${a}`);const e=re(a),n=oe(e);console.log(`[IncrementalValidation] Parsed: author="${e.author}", year=${e.year}, keyword="${e.keyword}"`),console.log(`[IncrementalValidation] Search query: "${n}"`);const r=await k([n],{yearMin:e.year?e.year-1:1980,yearMax:e.year?e.year+1:2025,limit:5});if(!r.success||r.papers.length===0){console.log(`[IncrementalValidation] No results for "${a}" - generating unverified entry`);const l=A(a,e);return{citationKey:a,status:"UNVERIFIED",confidence:0,bibtexEntry:l,searchQuery:n}}const o=se(r.papers,e);if(!o){console.log(`[IncrementalValidation] No good match for "${a}"`);const l=A(a,e);return{citationKey:a,status:"UNVERIFIED",confidence:.3,bibtexEntry:l,searchQuery:n}}const{paper:i,confidence:c}=o,s=le(a,i),f=c>=W?"VERIFIED":c>=Y?"PARTIAL":"UNVERIFIED";return console.log(`[IncrementalValidation] Found match: "${i.title}" (confidence: ${(c*100).toFixed(0)}%, status: ${f})`),{citationKey:a,status:f,confidence:c,bibtexEntry:s,paper:i,searchQuery:n}}function se(a,t){let e=null,n=0;for(const r of a){let o=0;if(t.year&&r.year&&(r.year===t.year?o+=.3:Math.abs(r.year-t.year)===1&&(o+=.2)),t.author&&r.authors&&r.authors.length>0){const i=t.author.toLowerCase();r.authors.some(s=>{var f;return s.name.toLowerCase().includes(i)||i.includes(((f=s.name.split(" ").pop())==null?void 0:f.toLowerCase())||"")})&&(o+=.4)}if(t.keyword&&r.title){const i=t.keyword.toLowerCase(),c=r.title.toLowerCase(),s=i.replace(/([a-z])([A-Z])/g,"$1 $2").split(" "),f=s.filter(l=>l.length>3&&c.includes(l));f.length>0&&(o+=.3*(f.length/s.length))}o>n&&(n=o,e=r)}return e&&n>=.4?{paper:e,confidence:Math.min(n,1)}:null}function le(a,t){var o,i,c,s;const e=((o=t.venue)==null?void 0:o.includes("Conference"))||((i=t.venue)==null?void 0:i.includes("Proceedings"))||((c=t.venue)==null?void 0:c.includes("Workshop")),n=e?"inproceedings":"article",r=[];if(r.push(`@${n}{${a},`),t.authors&&t.authors.length>0){const f=t.authors.map(l=>l.name).join(" and ");r.push(`  author = {${f}},`)}return r.push(`  title = {${t.title}},`),t.year&&r.push(`  year = {${t.year}},`),e&&t.venue?r.push(`  booktitle = {${t.venue}},`):(s=t.journal)!=null&&s.name?(r.push(`  journal = {${t.journal.name}},`),t.journal.volume&&r.push(`  volume = {${t.journal.volume}},`),t.journal.pages&&r.push(`  pages = {${t.journal.pages}},`)):t.venue&&r.push(`  journal = {${t.venue}},`),t.doi&&r.push(`  doi = {${t.doi}},`),t.url&&r.push(`  url = {${t.url}},`),r.push("  note = {Validated via Semantic Scholar}"),r.push("}"),r.join(`
`)}function A(a,t){const e=H(a);if(e)return console.log(`[IncrementalValidation] Found known reference for "${a}"`),Q(a,e);const n=V(a);if(n){console.log(`[IncrementalValidation] Using extracted LLM entry for "${a}"`);const s=[];return s.push("% Status: UNVERIFIED | Source: LLM_EXTRACTED | Confidence: 75%"),s.push(`@article{${a},`),s.push(`  author = {${n.authors}},`),s.push(`  title = {${n.title}},`),s.push(`  journal = {${n.venue}},`),s.push(`  year = {${n.year}},`),s.push("  note = {Extracted from LLM-generated bibliography}"),s.push("}"),s.join(`
`)}console.log(`[IncrementalValidation] Generating minimal entry for "${a}" (not in known DB)`);const r=[];r.push("% Status: UNVERIFIED | Source: LLM | Confidence: 0%"),r.push(`@article{${a},`);const o=t.author.charAt(0).toUpperCase()+t.author.slice(1);r.push(`  author = {${o}},`);const c=t.keyword.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")||`Research on ${o}'s Work`;return r.push(`  title = {${c}},`),t.year?r.push(`  year = {${t.year}},`):r.push("  year = {n.d.},"),r.push("  journal = {Working Paper},"),r.push("  note = {Citation requires verification}"),r.push("}"),r.join(`
`)}async function he(a,t){const e=[],n=a.filter(o=>!t.has(o));console.log(`[IncrementalValidation] Batch validating ${n.length} new citations (${a.length-n.length} already exist)`);const r=3;for(let o=0;o<n.length;o+=r){const i=n.slice(o,o+r),c=await Promise.all(i.map(s=>ie(s,t)));e.push(...c),o+r<n.length&&await new Promise(s=>setTimeout(s,200))}for(const o of a)t.has(o)&&e.push({citationKey:o,status:"ALREADY_EXISTS",confidence:1,bibtexEntry:""});return e}function de(a){const t=/\\cite\{([^}]+)\}/g,e=new Set;let n;for(;(n=t.exec(a))!==null;)n[1].split(",").map(o=>o.trim()).forEach(o=>e.add(o));return[...e]}export{de as extractCitationKeys,ue as validateAndEnrichReferences,he as validateCitationBatch,ie as validateSingleCitation};
