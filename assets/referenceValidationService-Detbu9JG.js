import{R as f,g as V,a as P}from"./index-Dp3b3LSd.js";function N(n){return n?n.split(/\s+and\s+/i).map(e=>e.trim()).filter(e=>e.length>0):[]}function v(n,t){const e=[new RegExp(`${t}\\s*=\\s*\\{([^}]*)\\}`,"i"),new RegExp(`${t}\\s*=\\s*"([^"]*)"`,"i"),new RegExp(`${t}\\s*=\\s*(\\d+)`,"i")];for(const a of e){const r=n.match(a);if(r)return r[1].trim()}}function F(n){const t=n.match(/%\s*Relevance:\s*(.+?)(?:\n|$)/i);return t?t[1].trim():void 0}function x(n,t=""){const e=n.match(/@(\w+)\s*\{\s*([^,\s]+)\s*,/i);if(!e)return null;const a=e[1].toLowerCase(),r=e[2],o=v(n,"title")||"",i=v(n,"author")||"",l=v(n,"year"),c=v(n,"journal"),u=v(n,"booktitle"),s=v(n,"publisher"),p=v(n,"volume"),y=v(n,"number"),h=v(n,"pages"),d=v(n,"doi"),m=v(n,"url"),g=l?parseInt(l,10):void 0,T=N(i),j=F(t),D=o.replace(/\{([^}]*)\}/g,"$1").replace(/\\&/g,"&").replace(/\\/g,"").trim();return{type:a,key:r,title:D,authors:T,year:isNaN(g)?void 0:g,journal:c,booktitle:u,publisher:s,volume:p,number:y,pages:h,doi:d,url:m,relevanceComment:j,rawEntry:n.trim()}}function B(n){const t=[],e=[],a=/@(\w+)\s*\{/gi;let r;const o=[];for(;(r=a.exec(n))!==null;)o.push(r.index);for(let i=0;i<o.length;i++){const l=o[i];i<o.length-1?o[i+1]:n.length;let c=0,u=l,s=!1;for(let h=l;h<n.length;h++){const d=n[h];if(d==="{")c++,s=!0;else if(d==="}"&&(c--,s&&c===0)){u=h+1;break}}const p=n.substring(l,u),y=n.substring(Math.max(0,l-200),l);try{const h=x(p,y);h&&(h.title?t.push(h):e.push(`Entry "${h.key}" has no title`))}catch(h){e.push(`Failed to parse entry at position ${l}: ${h}`)}}return{entries:t,errors:e,rawContent:n}}function R(n,t){const e={...n,...t},a=[];a.push(`@${e.type}{${e.key},`),e.authors&&e.authors.length>0&&a.push(`  author = {${e.authors.join(" and ")}},`),a.push(`  title = {${e.title}},`),e.journal&&a.push(`  journal = {${e.journal}},`),e.booktitle&&a.push(`  booktitle = {${e.booktitle}},`),e.publisher&&a.push(`  publisher = {${e.publisher}},`),e.year&&a.push(`  year = {${e.year}},`),e.volume&&a.push(`  volume = {${e.volume}},`),e.number&&a.push(`  number = {${e.number}},`),e.pages&&a.push(`  pages = {${e.pages}},`),e.doi&&a.push(`  doi = {${e.doi}},`),e.url&&a.push(`  url = {${e.url}},`);const r=a[a.length-1];return a[a.length-1]=r.replace(/,$/,""),a.push("}"),a.join(`
`)}function $(n,t,e){const a=n.split(/[,\s]+/)[0].toLowerCase().replace(/[^a-z]/g,""),r=t?t.toString():"nd",o=e.toLowerCase().replace(/^(the|a|an)\s+/i,"").split(/\s+/)[0].replace(/[^a-z]/g,"");return`${a}${r}${o}`}function O(n,t){const e=n.length,a=t.length,r=Array(e+1).fill(null).map(()=>Array(a+1).fill(0));for(let o=0;o<=e;o++)r[o][0]=o;for(let o=0;o<=a;o++)r[0][o]=o;for(let o=1;o<=e;o++)for(let i=1;i<=a;i++)n[o-1]===t[i-1]?r[o][i]=r[o-1][i-1]:r[o][i]=1+Math.min(r[o-1][i],r[o][i-1],r[o-1][i-1]);return r[e][a]}function S(n){return n.toLowerCase().replace(/[^\w\s-]/g," ").replace(/\s+/g," ").replace(/\b(the|a|an|of|and|in|on|for|to|with)\b/g,"").replace(/\s+/g," ").trim()}function U(n,t){const e=S(n),a=S(t);if(e===a)return 1;if(e.length===0||a.length===0)return 0;const r=O(e,a),o=Math.max(e.length,a.length);return 1-r/o}function _(n,t){const e=S(n),a=S(t);if(e===a)return 1;const r=e.split(/[:\-–—]/)[0].trim(),o=a.split(/[:\-–—]/)[0].trim();if(r===o&&r.length>10)return .95;const i=U(n,t);return e.includes(a)||a.includes(e)?Math.max(i,.85):i}function M(n){const t=n.trim();if(t.includes(","))return t.split(",")[0].trim().toLowerCase();const e=t.split(/\s+/);return e.length>=2?e[e.length-1].toLowerCase():t.toLowerCase()}function J(n,t){if(n.length===0||t.length===0)return 0;const e=n.map(M),a=t.map(M),r=e[0]===a[0],o=e.filter(c=>a.includes(c)).length,i=Math.max(e.length,a.length),l=o/i;return r?.5+.5*l:l*.8}function z(n,t){if(n.doi&&t.doi){const a=n.doi.toLowerCase().replace(/^https?:\/\/doi\.org\//i,""),r=t.doi.toLowerCase().replace(/^https?:\/\/doi\.org\//i,"");if(a===r)return!0}const e=_(n.title,t.title);return!!(e>.95||e>.85&&n.year&&t.year&&n.year===t.year||e>.75&&n.authors&&t.authors&&n.year&&t.year&&J(n.authors,t.authors)>.5&&Math.abs(n.year-t.year)<=1)}var L={};const W=typeof window<"u"?"":L.VERCEL_URL?`https://${L.VERCEL_URL}`:"http://localhost:3000",I=`${W}/api/semantic-scholar`,Y=.85,X=.65,b=2020,E=2025,G=5,C=10,H=5,w={davis1989perceived:{author:"Davis, Fred D.",title:"Perceived usefulness, perceived ease of use, and user acceptance of information technology",journal:"MIS Quarterly",year:1989,volume:"13",number:"3",pages:"319--340",doi:"10.2307/249008"},davis1989user:{author:"Davis, Fred D. and Bagozzi, Richard P. and Warshaw, Paul R.",title:"User acceptance of computer technology: A comparison of two theoretical models",journal:"Management Science",year:1989,volume:"35",number:"8",pages:"982--1003"},venkatesh2003user:{author:"Venkatesh, Viswanath and Morris, Michael G. and Davis, Gordon B. and Davis, Fred D.",title:"User acceptance of information technology: Toward a unified view",journal:"MIS Quarterly",year:2003,volume:"27",number:"3",pages:"425--478",doi:"10.2307/30036540"},venkatesh2012consumer:{author:"Venkatesh, Viswanath and Thong, James Y. L. and Xu, Xin",title:"Consumer acceptance and use of information technology: Extending the unified theory of acceptance and use of technology",journal:"MIS Quarterly",year:2012,volume:"36",number:"1",pages:"157--178"},delone1992information:{author:"DeLone, William H. and McLean, Ephraim R.",title:"Information systems success: The quest for the dependent variable",journal:"Information Systems Research",year:1992,volume:"3",number:"1",pages:"60--95",doi:"10.1287/isre.3.1.60"},delone2003delone:{author:"DeLone, William H. and McLean, Ephraim R.",title:"The DeLone and McLean model of information systems success: A ten-year update",journal:"Journal of Management Information Systems",year:2003,volume:"19",number:"4",pages:"9--30"},hevner2004design:{author:"Hevner, Alan R. and March, Salvatore T. and Park, Jinsoo and Ram, Sudha",title:"Design science in information systems research",journal:"MIS Quarterly",year:2004,volume:"28",number:"1",pages:"75--105",doi:"10.2307/25148625"},gregor2013positioning:{author:"Gregor, Shirley and Hevner, Alan R.",title:"Positioning and presenting design science research for maximum impact",journal:"MIS Quarterly",year:2013,volume:"37",number:"2",pages:"337--355"},peffers2007design:{author:"Peffers, Ken and Tuunanen, Tuure and Rothenberger, Marcus A. and Chatterjee, Samir",title:"A design science research methodology for information systems research",journal:"Journal of Management Information Systems",year:2007,volume:"24",number:"3",pages:"45--77"},orlikowski1992duality:{author:"Orlikowski, Wanda J.",title:"The duality of technology: Rethinking the concept of technology in organizations",journal:"Organization Science",year:1992,volume:"3",number:"3",pages:"398--427",doi:"10.1287/orsc.3.3.398"},orlikowski2000using:{author:"Orlikowski, Wanda J.",title:"Using technology and constituting structures: A practice lens for studying technology in organizations",journal:"Organization Science",year:2e3,volume:"11",number:"4",pages:"404--428"},dimaggio1983iron:{author:"DiMaggio, Paul J. and Powell, Walter W.",title:"The iron cage revisited: Institutional isomorphism and collective rationality in organizational fields",journal:"American Sociological Review",year:1983,volume:"48",number:"2",pages:"147--160"},barabasi1999emergence:{author:"Barabasi, Albert-Laszlo and Albert, Reka",title:"Emergence of scaling in random networks",journal:"Science",year:1999,volume:"286",number:"5439",pages:"509--512"},barabasi2016network:{author:"Barabasi, Albert-Laszlo",title:"Network science",journal:"Cambridge University Press",year:2016},newman2001structure:{author:"Newman, Mark E. J.",title:"The structure of scientific collaboration networks",journal:"Proceedings of the National Academy of Sciences",year:2001,volume:"98",number:"2",pages:"404--409"},newman2003mixing:{author:"Newman, Mark E. J.",title:"Mixing patterns in networks",journal:"Physical Review E",year:2003,volume:"67",number:"2",pages:"026126"},merton1968matthew:{author:"Merton, Robert K.",title:"The Matthew effect in science",journal:"Science",year:1968,volume:"159",number:"3810",pages:"56--63"},merton1973sociology:{author:"Merton, Robert K.",title:"The sociology of science: Theoretical and empirical investigations",journal:"University of Chicago Press",year:1973},crane1972invisible:{author:"Crane, Diana",title:"Invisible colleges: Diffusion of knowledge in scientific communities",journal:"University of Chicago Press",year:1972},bandura1977social:{author:"Bandura, Albert",title:"Social learning theory",journal:"Prentice Hall",year:1977},bourdieu1986forms:{author:"Bourdieu, Pierre",title:"The forms of capital",journal:"Handbook of Theory and Research for the Sociology of Education",year:1986,pages:"241--258"},burt2004structural:{author:"Burt, Ronald S.",title:"Structural holes and good ideas",journal:"American Journal of Sociology",year:2004,volume:"110",number:"2",pages:"349--399"},wasserman1994social:{author:"Wasserman, Stanley and Faust, Katherine",title:"Social network analysis: Methods and applications",journal:"Cambridge University Press",year:1994},freeman1977set:{author:"Freeman, Linton C.",title:"A set of measures of centrality based on betweenness",journal:"Sociometry",year:1977,volume:"40",number:"1",pages:"35--41"},blondel2008fast:{author:"Blondel, Vincent D. and Guillaume, Jean-Loup and Lambiotte, Renaud and Lefebvre, Etienne",title:"Fast unfolding of communities in large networks",journal:"Journal of Statistical Mechanics: Theory and Experiment",year:2008,volume:"2008",number:"10",pages:"P10008"},malmgren2010role:{author:"Malmgren, R. Dean and Ottino, Julio M. and Amaral, Luis A. Nunes",title:"The role of mentorship in protege performance",journal:"Nature",year:2010,volume:"465",number:"7298",pages:"622--626"},clauset2015systematic:{author:"Clauset, Aaron and Arbesman, Samuel and Larremore, Daniel B.",title:"Systematic inequality and hierarchy in faculty hiring networks",journal:"Science Advances",year:2015,volume:"1",number:"1",pages:"e1400005"},stinchcombe1965social:{author:"Stinchcombe, Arthur L.",title:"Social structure and organizations",journal:"Handbook of Organizations",year:1965,pages:"142--193"},marquis2013imprinting:{author:"Marquis, Christopher and Tilcsik, Andras",title:"Imprinting: Toward a multilevel theory",journal:"Academy of Management Annals",year:2013,volume:"7",number:"1",pages:"195--245"},benbasat2003identity:{author:"Benbasat, Izak and Zmud, Robert W.",title:"The identity crisis within the IS discipline: Defining and communicating the discipline's core properties",journal:"MIS Quarterly",year:2003,volume:"27",number:"2",pages:"183--194"},sidorova2008uncovering:{author:"Sidorova, Anna and Evangelopoulos, Nicholas and Valacich, Joseph S. and Ramakrishnan, Thiagarajan",title:"Uncovering the intellectual core of the information systems discipline",journal:"MIS Quarterly",year:2008,volume:"32",number:"3",pages:"467--482"},grover2012state:{author:"Grover, Varun and Lyytinen, Kalle and Srinivasan, Ananth and Tan, Bernard C. Y.",title:"Contributing to rigorous and forward thinking explanatory theory",journal:"Journal of the Association for Information Systems",year:2012,volume:"13",number:"6",pages:"393--422"},lowry2013state:{author:"Lowry, Paul Benjamin and Moody, Gregory D. and Gaskin, James and Galletta, Dennis F. and Humpherys, Sean L. and Barlow, Jordan B. and Wilson, David W.",title:"Evaluating journal quality and the Association for Information Systems Senior Scholars' journal basket via bibliometric measures",journal:"MIS Quarterly",year:2013,volume:"37",number:"4",pages:"993--1012"},hirschheim2012information:{author:"Hirschheim, Rudy and Klein, Heinz K.",title:"A glorious and not-so-short history of the information systems field",journal:"Journal of the Association for Information Systems",year:2012,volume:"13",number:"4",pages:"188--235"}};function Q(n){if(w[n])return w[n];const t=n.match(/^([a-z]+)(\d{4})/i);if(t){const[,e,a]=t,r=parseInt(a,10);for(const[o,i]of Object.entries(w))if(o.toLowerCase().startsWith(e.toLowerCase())&&i.year===r)return i}}function q(n,t){const e=[];return e.push("% Status: VERIFIED | Source: KNOWN_DB | Confidence: 95%"),e.push(`@article{${n},`),e.push(`  author = {${t.author}},`),e.push(`  title = {${t.title}},`),e.push(`  journal = {${t.journal}},`),e.push(`  year = {${t.year}}`),t.volume&&e.push(`, volume = {${t.volume}}`),t.number&&e.push(`, number = {${t.number}}`),t.pages&&e.push(`, pages = {${t.pages}}`),t.doi&&e.push(`, doi = {${t.doi}}`),e.push("}"),e.join(`
`)}async function Z(n){try{const t=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"validate",references:n})});return t.ok?await t.json():(console.error(`[RefValidation] SS validate failed: ${t.status}`),{success:!1,results:[]})}catch(t){return console.error("[RefValidation] SS validate error:",t),{success:!1,results:[]}}}async function k(n,t){try{const e=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"search",keywords:n,fieldsOfStudy:["Computer Science"],yearMin:(t==null?void 0:t.yearMin)||b,yearMax:(t==null?void 0:t.yearMax)||E,limit:(t==null?void 0:t.limit)||C})});return e.ok?await e.json():(console.error(`[RefValidation] SS search failed: ${e.status}`),{success:!1,papers:[]})}catch(e){return console.error("[RefValidation] SS search error:",e),{success:!1,papers:[]}}}async function K(n,t){try{const e=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"citations",paperId:n,type:t,limit:H})});return e.ok?await e.json():{success:!1,papers:[]}}catch(e){return console.error("[RefValidation] SS citations error:",e),{success:!1,papers:[]}}}async function ee(n){console.log(`[RefValidation] Phase 2: Validating ${n.length} LLM references`);const t=n.map(a=>({bibKey:a.key,title:a.title,authors:a.authors,year:a.year})),e=await Z(t);return e.success?e.results.map(a=>{const r=n.find(o=>o.key===a.bibKey);return{bibKey:a.bibKey,originalTitle:a.originalTitle,originalAuthors:r==null?void 0:r.authors,originalYear:r==null?void 0:r.year,status:a.status==="VERIFIED"?f.VERIFIED:a.status==="PARTIAL"?f.PARTIAL:f.UNVERIFIED,confidence:a.confidence,ssMatch:a.paper,discrepancies:a.discrepancies,source:"LLM"}}):n.map(a=>({bibKey:a.key,originalTitle:a.title,originalAuthors:a.authors,originalYear:a.year,status:f.UNVERIFIED,confidence:0,source:"LLM"}))}function te(n){const t=n.toLowerCase(),e=["information systems","digital transformation","artificial intelligence","machine learning","technology adoption","user acceptance","blockchain","social media","cybersecurity","data analytics","cloud computing","e-commerce","digital platform","IT governance","knowledge management","business intelligence","enterprise systems","human-computer interaction","technology acceptance model","TAM","UTAUT","IS success","digital innovation","IT investment","software development","agile","devops","healthcare IT","fintech","smart city","IoT","internet of things"],a=[];for(const o of e)t.includes(o.toLowerCase())&&a.push(o);const r=t.split(/\s+/).filter(o=>o.length>4);return[...new Set(r)],a.slice(0,G)}async function ne(n,t){var i,l,c,u,s,p,y;console.log("[RefValidation] Phase 3: Discovering additional papers");const e=[],a=new Set(t.map(h=>h.originalTitle.toLowerCase())),r=te(n);if(r.length>0){console.log(`[RefValidation] Searching with keywords: ${r.join(", ")}`);const h=await k(r,{yearMin:b,yearMax:E,limit:C});if(h.success)for(const d of h.papers)a.has(d.title.toLowerCase())||(d.citationCount||0)<5||(e.push({bibKey:$(((l=(i=d.authors)==null?void 0:i[0])==null?void 0:l.name)||"unknown",d.year,d.title),originalTitle:d.title,originalAuthors:(c=d.authors)==null?void 0:c.map(m=>m.name),originalYear:d.year,status:f.DISCOVERED,confidence:1,ssMatch:d,source:"SS_SEARCH"}),a.add(d.title.toLowerCase()))}const o=t.filter(h=>{var d;return h.status===f.VERIFIED&&((d=h.ssMatch)==null?void 0:d.paperId)});if(o.length>0)for(const h of o.slice(0,3)){if(!((u=h.ssMatch)!=null&&u.paperId))continue;const d=await K(h.ssMatch.paperId,"citations");if(d.success)for(const m of d.papers)a.has(m.title.toLowerCase())||(m.citationCount||0)<10||!m.year||m.year<b||(e.push({bibKey:$(((p=(s=m.authors)==null?void 0:s[0])==null?void 0:p.name)||"unknown",m.year,m.title),originalTitle:m.title,originalAuthors:(y=m.authors)==null?void 0:y.map(g=>g.name),originalYear:m.year,status:f.DISCOVERED,confidence:1,ssMatch:m,source:"SS_CITATION_GRAPH"}),a.add(m.title.toLowerCase()))}return console.log(`[RefValidation] Discovered ${e.length} additional papers`),e}function ae(n,t,e){console.log("[RefValidation] Phase 4: Merging and deduplicating");const r=[...n].sort((i,l)=>{const c={[f.VERIFIED]:0,[f.PARTIAL]:1,[f.UNVERIFIED]:2,[f.REJECTED]:3,[f.DISCOVERED]:4};return c[i.status]-c[l.status]}).filter(i=>i.status!==f.REJECTED),o=new Set(r.map(i=>i.originalTitle.toLowerCase()));for(const i of t){if(r.length>=e.max)break;r.some(c=>z({title:c.originalTitle,authors:c.originalAuthors,year:c.originalYear},{title:i.originalTitle,authors:i.originalAuthors,year:i.originalYear}))||(r.push(i),o.add(i.originalTitle.toLowerCase()))}return console.log(`[RefValidation] Merged: ${r.length} references (${n.length} LLM + ${r.length-n.filter(i=>i.status!==f.REJECTED).length} discovered)`),r}function re(n,t,e){var i,l,c,u;console.log("[RefValidation] Phase 5: Generating final BibTeX");const a=[];a.push("% === REFERENCE VALIDATION REPORT ==="),a.push(`% Timestamp: ${e.timestamp}`),a.push(`% Total references: ${e.totalReferences}`),a.push(`% Verified: ${e.verified} (${(e.verified/e.totalReferences*100).toFixed(0)}%)`),a.push(`% Partial: ${e.partial} (${(e.partial/e.totalReferences*100).toFixed(0)}%)`),a.push(`% Unverified: ${e.unverified} (${(e.unverified/e.totalReferences*100).toFixed(0)}%)`),a.push(`% Discovered: ${e.discovered} (${(e.discovered/e.totalReferences*100).toFixed(0)}%)`),a.push(`% Recency (${b}-${E}): ${(e.recencyScore*100).toFixed(0)}%`),a.push(`% Verification rate: ${(e.verificationRate*100).toFixed(0)}%`),a.push("% ====================================="),a.push("");const o=!n.some(s=>s.status===f.VERIFIED||s.status===f.PARTIAL||s.status===f.DISCOVERED);o&&(a.push("% WARNING: No verified references found. Including unverified entries as fallback."),a.push("% These references should be manually verified before submission."),a.push(""));for(const s of n){if(s.status===f.UNVERIFIED&&!o)continue;a.push(`% Status: ${s.status} | Source: ${s.source}${s.confidence<1?` | Confidence: ${(s.confidence*100).toFixed(0)}%`:""}`),s.discrepancies&&s.discrepancies.length>0&&a.push(`% Discrepancies: ${s.discrepancies.join("; ")}`);const p=t.find(y=>y.key===s.bibKey);if(p&&(s.status===f.VERIFIED||s.status===f.PARTIAL)){const y={};s.ssMatch&&(s.ssMatch.doi&&(y.doi=s.ssMatch.doi),s.ssMatch.url&&(y.url=s.ssMatch.url)),a.push(R(p,y))}else if(s.ssMatch){const y={type:(i=s.ssMatch.venue)!=null&&i.includes("Conference")||(l=s.ssMatch.venue)!=null&&l.includes("Proceedings")?"inproceedings":"article",key:s.bibKey,title:s.ssMatch.title,authors:((c=s.ssMatch.authors)==null?void 0:c.map(h=>h.name))||[],year:s.ssMatch.year,journal:(u=s.ssMatch.journal)==null?void 0:u.name,booktitle:s.ssMatch.venue,doi:s.ssMatch.doi,url:s.ssMatch.url,rawEntry:""};a.push(R(y))}else p&&a.push(R(p));a.push("")}return a.join(`
`)}async function he(n,t,e){e!=null&&e.targetMin;const a=(e==null?void 0:e.targetMax)||35;console.log("[RefValidation] Starting reference validation pipeline");const r=B(n);if(r.errors.length>0&&console.warn("[RefValidation] BibTeX parse errors:",r.errors),r.entries.length===0)return console.error("[RefValidation] No valid BibTeX entries found"),{bibtex:n,report:{timestamp:new Date().toISOString(),totalReferences:0,verified:0,partial:0,unverified:0,rejected:0,discovered:0,recencyScore:0,verificationRate:0,hallucinationRate:0,validatedReferences:[],discoveredReferences:[],errors:["No valid BibTeX entries found"]}};console.log(`[RefValidation] Parsed ${r.entries.length} BibTeX entries`);const o=await ee(r.entries);let i=[];e!=null&&e.skipDiscovery||(i=await ne(t,o));const l=ae(o,i,{max:a}),c=l.filter(g=>g.status===f.VERIFIED).length,u=l.filter(g=>g.status===f.PARTIAL).length,s=l.filter(g=>g.status===f.UNVERIFIED).length,p=o.filter(g=>g.status===f.REJECTED).length,y=l.filter(g=>g.status===f.DISCOVERED).length,h=l.filter(g=>g.originalYear&&g.originalYear>=b&&g.originalYear<=E).length,d={timestamp:new Date().toISOString(),totalReferences:l.length,verified:c,partial:u,unverified:s,rejected:p,discovered:y,recencyScore:l.length>0?h/l.length:0,verificationRate:l.length>0?(c+u)/l.length:0,hallucinationRate:o.length>0?p/o.length:0,validatedReferences:o,discoveredReferences:i,errors:r.errors},m=re(l,r.entries,d);return console.log(`[RefValidation] Complete: ${l.length} refs, ${(d.verificationRate*100).toFixed(0)}% verified, ${(d.recencyScore*100).toFixed(0)}% recent`),{bibtex:m,report:d}}function oe(n){const t=n.match(/^([a-z]+)(\d{4})(.*)$/i);if(t)return{author:t[1],year:parseInt(t[2],10),keyword:t[3]||""};const e=n.match(/(\d{4})/),a=e?parseInt(e[1],10):null;return{author:n.replace(/\d+/g,"").replace(/[^a-zA-Z]/g,""),year:a,keyword:""}}function ie(n){const t=[];if(n.author&&t.push(n.author),n.keyword){const e=n.keyword.replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase();t.push(e)}return t.join(" ")}async function se(n,t){if(t.has(n))return{citationKey:n,status:"ALREADY_EXISTS",confidence:1,bibtexEntry:""};console.log(`[IncrementalValidation] Validating citation: ${n}`);const e=oe(n),a=ie(e);console.log(`[IncrementalValidation] Parsed: author="${e.author}", year=${e.year}, keyword="${e.keyword}"`),console.log(`[IncrementalValidation] Search query: "${a}"`);const r=await k([a],{yearMin:e.year?e.year-1:1980,yearMax:e.year?e.year+1:2025,limit:5});if(!r.success||r.papers.length===0){console.log(`[IncrementalValidation] No results for "${n}" - generating unverified entry`);const s=A(n,e);return{citationKey:n,status:"UNVERIFIED",confidence:0,bibtexEntry:s,searchQuery:a}}const o=le(r.papers,e);if(!o){console.log(`[IncrementalValidation] No good match for "${n}"`);const s=A(n,e);return{citationKey:n,status:"UNVERIFIED",confidence:.3,bibtexEntry:s,searchQuery:a}}const{paper:i,confidence:l}=o,c=ce(n,i),u=l>=Y?"VERIFIED":l>=X?"PARTIAL":"UNVERIFIED";return console.log(`[IncrementalValidation] Found match: "${i.title}" (confidence: ${(l*100).toFixed(0)}%, status: ${u})`),{citationKey:n,status:u,confidence:l,bibtexEntry:c,paper:i,searchQuery:a}}function le(n,t){let e=null,a=0;for(const r of n){let o=0;if(t.year&&r.year&&(r.year===t.year?o+=.3:Math.abs(r.year-t.year)===1&&(o+=.2)),t.author&&r.authors&&r.authors.length>0){const i=t.author.toLowerCase();r.authors.some(c=>{var u;return c.name.toLowerCase().includes(i)||i.includes(((u=c.name.split(" ").pop())==null?void 0:u.toLowerCase())||"")})&&(o+=.4)}if(t.keyword&&r.title){const i=t.keyword.toLowerCase(),l=r.title.toLowerCase(),c=i.replace(/([a-z])([A-Z])/g,"$1 $2").split(" "),u=c.filter(s=>s.length>3&&l.includes(s));u.length>0&&(o+=.3*(u.length/c.length))}o>a&&(a=o,e=r)}return e&&a>=.4?{paper:e,confidence:Math.min(a,1)}:null}function ce(n,t){var o,i,l,c;const e=((o=t.venue)==null?void 0:o.includes("Conference"))||((i=t.venue)==null?void 0:i.includes("Proceedings"))||((l=t.venue)==null?void 0:l.includes("Workshop")),a=e?"inproceedings":"article",r=[];if(r.push(`@${a}{${n},`),t.authors&&t.authors.length>0){const u=t.authors.map(s=>s.name).join(" and ");r.push(`  author = {${u}},`)}return r.push(`  title = {${t.title}},`),t.year&&r.push(`  year = {${t.year}},`),e&&t.venue?r.push(`  booktitle = {${t.venue}},`):(c=t.journal)!=null&&c.name?(r.push(`  journal = {${t.journal.name}},`),t.journal.volume&&r.push(`  volume = {${t.journal.volume}},`),t.journal.pages&&r.push(`  pages = {${t.journal.pages}},`)):t.venue&&r.push(`  journal = {${t.venue}},`),t.doi&&r.push(`  doi = {${t.doi}},`),t.url&&r.push(`  url = {${t.url}},`),r.push("  note = {Validated via Semantic Scholar}"),r.push("}"),r.join(`
`)}function A(n,t){const e=V(n);if(e)return console.log(`[IncrementalValidation] Using LLM-generated BibTeX for "${n}"`),`% Status: LLM_GENERATED | Source: LLM | Confidence: 90%
${e}`;const a=Q(n);if(a)return console.log(`[IncrementalValidation] Found known reference for "${n}"`),q(n,a);const r=P(n);if(r){console.log(`[IncrementalValidation] Using extracted LLM entry for "${n}"`);const u=[];return u.push("% Status: UNVERIFIED | Source: LLM_EXTRACTED | Confidence: 75%"),u.push(`@article{${n},`),u.push(`  author = {${r.authors}},`),u.push(`  title = {${r.title}},`),u.push(`  journal = {${r.venue}},`),u.push(`  year = {${r.year}},`),u.push("  note = {Extracted from LLM-generated bibliography}"),u.push("}"),u.join(`
`)}console.log(`[IncrementalValidation] Generating minimal entry for "${n}" (not in known DB or LLM output)`);const o=[];o.push("% Status: UNVERIFIED | Source: LLM | Confidence: 0%"),o.push(`@article{${n},`);const i=t.author.charAt(0).toUpperCase()+t.author.slice(1);o.push(`  author = {${i}},`);const c=t.keyword.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(u=>u.charAt(0).toUpperCase()+u.slice(1).toLowerCase()).join(" ")||`Research on ${i}'s Work`;return o.push(`  title = {${c}},`),t.year?o.push(`  year = {${t.year}},`):o.push("  year = {n.d.},"),o.push("  journal = {Working Paper},"),o.push("  note = {Citation requires verification}"),o.push("}"),o.join(`
`)}async function de(n,t){const e=[],a=n.filter(o=>!t.has(o));console.log(`[IncrementalValidation] Batch validating ${a.length} new citations (${n.length-a.length} already exist)`);const r=3;for(let o=0;o<a.length;o+=r){const i=a.slice(o,o+r),l=await Promise.all(i.map(c=>se(c,t)));e.push(...l),o+r<a.length&&await new Promise(c=>setTimeout(c,200))}for(const o of n)t.has(o)&&e.push({citationKey:o,status:"ALREADY_EXISTS",confidence:1,bibtexEntry:""});return e}function fe(n){const t=/\\cite\{([^}]+)\}/g,e=new Set;let a;for(;(a=t.exec(n))!==null;)a[1].split(",").map(o=>o.trim()).forEach(o=>e.add(o));return[...e]}export{fe as extractCitationKeys,he as validateAndEnrichReferences,de as validateCitationBatch,se as validateSingleCitation};
